<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-\.]+"><link rel="shortcut icon" href="../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Cloud Environment - The Unofficial GKE Security Guide</title><link rel="stylesheet" href="../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#2196f3"><script src="../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../assets/fonts/material-icons.css"></head><body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#cloud-environment" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href=".." title="The Unofficial GKE Security Guide" class="md-header-nav__button md-logo"><i class="md-icon">cloud</i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">The Unofficial GKE Security Guide</span><span class="md-header-nav__topic">Cloud Environment</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/bgeesaman/gkesecurity-guide/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">bgeesaman/gkesecurity-guide</div></a></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href=".." title="The Unofficial GKE Security Guide" class="md-nav__button md-logo"><i class="md-icon">cloud</i></a>The Unofficial GKE Security Guide</label><div class="md-nav__source"><a href="https://github.com/bgeesaman/gkesecurity-guide/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">bgeesaman/gkesecurity-guide</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href=".." title="Introduction" class="md-nav__link">Introduction</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Cloud Environment</label><a href="./" title="Cloud Environment" class="md-nav__link md-nav__link--active">Cloud Environment</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#identity-and-iam-hierarchy-todo" title="Identity and IAM Hierarchy (TODO)" class="md-nav__link">Identity and IAM Hierarchy (TODO)</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#best-practices" title="Best Practices" class="md-nav__link">Best Practices</a></li><li class="md-nav__item"><a href="#resources" title="Resources" class="md-nav__link">Resources</a></li></ul></nav></li><li class="md-nav__item"><a href="#organization-folder-and-project-structure" title="Organization, Folder, and Project Structure" class="md-nav__link">Organization, Folder, and Project Structure</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#best-practices_1" title="Best Practices" class="md-nav__link">Best Practices</a></li><li class="md-nav__item"><a href="#resources_1" title="Resources" class="md-nav__link">Resources</a></li></ul></nav></li><li class="md-nav__item"><a href="#cluster-networking" title="Cluster Networking" class="md-nav__link">Cluster Networking</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#best-practices_2" title="Best Practices" class="md-nav__link">Best Practices</a></li><li class="md-nav__item"><a href="#resources_2" title="Resources" class="md-nav__link">Resources</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="../project_organization/" title="Project Organization" class="md-nav__link">Project Organization</a></li><li class="md-nav__item"><a href="../cluster_configuration/" title="Cluster Configuration" class="md-nav__link">Cluster Configuration</a></li><li class="md-nav__item"><a href="../cluster_lifecycle/" title="Cluster Lifecycle" class="md-nav__link">Cluster Lifecycle</a></li><li class="md-nav__item"><a href="../cluster_observability/" title="Cluster Observability" class="md-nav__link">Cluster Observability</a></li><li class="md-nav__item"><a href="../cluster_addons/" title="Cluster Add-ons" class="md-nav__link">Cluster Add-ons</a></li><li class="md-nav__item"><a href="../workload_configuration/" title="Workload Configuration" class="md-nav__link">Workload Configuration</a></li><li class="md-nav__item"><a href="../container_images/" title="Container Images" class="md-nav__link">Container Images</a></li><li class="md-nav__item"><a href="../audit_and_compliance/" title="Audit and Compliance" class="md-nav__link">Audit and Compliance</a></li><li class="md-nav__item"><a href="../detection_and_response/" title="Detection and Response" class="md-nav__link">Detection and Response</a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#identity-and-iam-hierarchy-todo" title="Identity and IAM Hierarchy (TODO)" class="md-nav__link">Identity and IAM Hierarchy (TODO)</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#best-practices" title="Best Practices" class="md-nav__link">Best Practices</a></li><li class="md-nav__item"><a href="#resources" title="Resources" class="md-nav__link">Resources</a></li></ul></nav></li><li class="md-nav__item"><a href="#organization-folder-and-project-structure" title="Organization, Folder, and Project Structure" class="md-nav__link">Organization, Folder, and Project Structure</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#best-practices_1" title="Best Practices" class="md-nav__link">Best Practices</a></li><li class="md-nav__item"><a href="#resources_1" title="Resources" class="md-nav__link">Resources</a></li></ul></nav></li><li class="md-nav__item"><a href="#cluster-networking" title="Cluster Networking" class="md-nav__link">Cluster Networking</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#best-practices_2" title="Best Practices" class="md-nav__link">Best Practices</a></li><li class="md-nav__item"><a href="#resources_2" title="Resources" class="md-nav__link">Resources</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><a href="https://github.com/bgeesaman/gkesecurity-guide/edit/master/docs/cloud_environment.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a><h1 id="cloud-environment">Cloud Environment<a class="headerlink" href="#cloud-environment" title="Permanent link">&para;</a></h1>
<h2 id="identity-and-iam-hierarchy-todo">Identity and IAM Hierarchy (TODO)<a class="headerlink" href="#identity-and-iam-hierarchy-todo" title="Permanent link">&para;</a></h2>
<p>At the foundation of your GCP Organization is a relationship with your trusted identity provider.  Commonly, this is a Gsuite domain or a Cloud Identity installation.  It's the basis of trust for how users and groups are managed throughout the GCP environments.  It's where you audit logins/logouts, enforce MFA and session duration, and more.</p>
<p>It's important to understand that in a GCP Organization, <em>where</em> a user is granted permissions is just as important as <em>what</em> permissions are granted.  For example, granting a user or service account a binding to an IAM role for <code>Storage Admin</code> at the Project level allows that account to have all those permissions for all GCS buckets in that Project.</p>
<p>Consider a somewhat realistic scenario:  That Project has GCS buckets for storing audit logs, VPC flow logs, and firewall logs.  The security team is given <code>Storage Admin</code> permissions to manage these.  Also in that same Project, a development team wants to store some data used by their application.  They too, get assigned <code>Storage Admin</code> permissions to that Project.  There are a few problems:</p>
<ul>
<li>Unless the security team is the one that made the IAM permissions assignment, they might not be aware of the exposure of their security log and event data.  This jeopardizes the integrity of the information if needed for incident response and guaranteeing chain of custody.</li>
<li>The development team now has access to this sensitive security information.  Even though they may never access it or need to, this violates the principle of least privilege.</li>
<li>Any time a new GCS bucket is added to this Project, both teams will have access to it automatically.  This can often be undesired behavior and tricky to untangle.</li>
</ul>
<p>Things get even more interesting when you consider a group of Projects organized into a GCP Folder.  Permissions granted to a Folder "trickle down" to the Folders and Projects inside them.  Because permissions are <em>additive</em>, a descendent Project can't block or override those permissions.  Therefore, careful consideration must be given to access granted at each level, and special attention is needed for IAM roles bound to users/groups/service accounts at the Folder or Organization levels.  Some examples to consider:</p>
<ul>
<li>If a user is assigned the primitive role <code>Owner</code> at the Organization level, they will be <code>Owner</code> in every single Project in the entire organization.  The risk of compromise of those specific credentials (and by extension, that user's primary computing devices) is immediately increased to undesired levels.</li>
<li>Granting <code>Viewer</code> at the Organization level allows reading all GCS buckets, all StackDriver logs, and viewing the configurations of most resources.  In many cases, sensitive data is found in any or all of those places that can be used to escalate privileges.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">IAM "Overcrowding"</p>
<p>The IAM page in the GCP Console tends to get "crowded" and harder to visually reason about when there are lots of individual bindings.  Each IAM Role binding increases the cognitive load when reviewing permissions.  Over time, this can get unwieldy and difficult to consolidate once systems and services are running in production.</p>
</div>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Use a single Identity Provider</strong> - If all users and groups are originating from a single domain and are managed centrally, maintaining the proper IAM permissions throughout the GCP Organization is greatly simplified.</li>
<li><strong>Ensure all accounts use Multi-Factor Authentication (MFA)</strong> - Protecting the theft and misuse of GCP account credentials is the first and most important step to protecting your GCP infrastructure.  If a set of credentials is stolen or a laptop lost, the window for those credentials to be valid is greatly reduced.</li>
<li><strong>Consolidate Users into Groups</strong> - Instead of granting individual users access, consider using a group, placing that user in that group, and granting access to the group.  This way, if that person leaves the organization, it doesn't leave orphaned/unused accounts clogging up the IAM permissions listings that have to be manually removed using gcloud/UI.  Also, when replacing that person who left, it's a simpler process of just adding the new person(s) to the same groups.  No gcloud/UI changes are then necessary.</li>
<li><strong>Follow the Principle of Least Privilege</strong> - Take care when granting access Project-wide and even greater care when granting access at the Folder and Organization levels.  There are often unintended consequences of over-granting permissions.  Additionally, it's much harder to safely remove that binding as time goes on because inherited permissions might be required in a descendent project.</li>
</ul>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cloud.google.com/resource-manager/docs/creating-managing-organization">Creating and Managing GCP Organizations</a></li>
<li><a href="https://gsuite.google.com/security/">GSuite Security</a></li>
<li><a href="https://cloud.google.com/identity/docs/concepts/overview">Cloud Identity Overview</a></li>
<li><a href="https://cloud.google.com/iam/docs/overview">Cloud IAM Overview</a></li>
</ul>
<h2 id="organization-folder-and-project-structure">Organization, Folder, and Project Structure<a class="headerlink" href="#organization-folder-and-project-structure" title="Permanent link">&para;</a></h2>
<p>Why it's so important early, dictates IAM permission granularity/simplicity, project is the IAM boundary for most permissions types.  Why moving folders/projects isn't straightforward.</p>
<h3 id="best-practices_1">Best Practices<a class="headerlink" href="#best-practices_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Early decisions have inertia</li>
<li><strong>Decide on Naming Conventions Early</strong> - Names of Projects</li>
<li>Do not map to organization/team names</li>
<li>Map to geographic folder</li>
<li>Map to services/apps folders/projects</li>
<li>Group by deployment env (sandbox/dev/stage/prod)</li>
<li>Separate projects for GCR, GCS, SecOps (forseti)</li>
</ul>
<h3 id="resources_1">Resources<a class="headerlink" href="#resources_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Official GCP docs - Mapping IAM to folders/projects </li>
<li>Examples of organization structures</li>
</ul>
<h2 id="cluster-networking">Cluster Networking<a class="headerlink" href="#cluster-networking" title="Permanent link">&para;</a></h2>
<p>VPC (shared vs peering based on administration model)</p>
<h3 id="best-practices_2">Best Practices<a class="headerlink" href="#best-practices_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Do not overlap CIDRs</li>
<li>Use VPC Aliasing</li>
<li>Watch limits/quotas</li>
</ul>
<h3 id="resources_2">Resources<a class="headerlink" href="#resources_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Official GCP docs (shared vpc, vpc peering)</li>
<li>VPC quotas/limits</li>
<li>GKE VPC aliasing/subnetting</li>
</ul></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>Introduction</span></div></a><a href="../project_organization/" title="Project Organization" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>Project Organization</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright">powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div><div class="md-footer-social"><link rel="stylesheet" href="../assets/fonts/font-awesome.css"> <a href="https://github.com/bgeesaman" class="md-footer-social__link fa fa-github-alt"></a>  <a href="https://twitter.com/bradgeesaman" class="md-footer-social__link fa fa-twitter"></a>  <a href="https://linkedin.com/in/bradgeesaman" class="md-footer-social__link fa fa-linkedin"></a> </div></div></div></footer></div><script src="../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:".."}})</script></body></html>