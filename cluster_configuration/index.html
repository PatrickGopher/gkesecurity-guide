



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-\.]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Cluster Configuration - The Unofficial GKE Security Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cluster-configuration" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="The Unofficial GKE Security Guide" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              The Unofficial GKE Security Guide
            </span>
            <span class="md-header-nav__topic">
              
                Cluster Configuration
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/bgeesaman/gkesecurity-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    bgeesaman/gkesecurity-guide
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="The Unofficial GKE Security Guide" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    The Unofficial GKE Security Guide
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/bgeesaman/gkesecurity-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    bgeesaman/gkesecurity-guide
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cloud_environment/" title="Cloud Environment" class="md-nav__link">
      Cloud Environment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../project_organization/" title="Project Organization" class="md-nav__link">
      Project Organization
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Cluster Configuration
      </label>
    
    <a href="./" title="Cluster Configuration" class="md-nav__link md-nav__link--active">
      Cluster Configuration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-gke-cluster-architecture" title="The GKE Cluster Architecture" class="md-nav__link">
    The GKE Cluster Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resources" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geographical-placement-and-cluster-types" title="Geographical Placement and Cluster Types" class="md-nav__link">
    Geographical Placement and Cluster Types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_1" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-cloud-iam-and-kubernetes-rbac" title="Google Cloud IAM and Kubernetes RBAC" class="md-nav__link">
    Google Cloud IAM and Kubernetes RBAC
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices_1" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_2" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-access" title="Cluster Access" class="md-nav__link">
    Cluster Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-settings" title="Cluster Settings" class="md-nav__link">
    Cluster Settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-pool-settings" title="Node Pool Settings" class="md-nav__link">
    Node Pool Settings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_lifecycle/" title="Cluster Lifecycle" class="md-nav__link">
      Cluster Lifecycle
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_observability/" title="Cluster Observability" class="md-nav__link">
      Cluster Observability
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_addons/" title="Cluster Add-ons" class="md-nav__link">
      Cluster Add-ons
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../workload_configuration/" title="Workload Configuration" class="md-nav__link">
      Workload Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../container_images/" title="Container Images" class="md-nav__link">
      Container Images
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../audit_and_compliance/" title="Audit and Compliance" class="md-nav__link">
      Audit and Compliance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../detection_and_response/" title="Detection and Response" class="md-nav__link">
      Detection and Response
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-gke-cluster-architecture" title="The GKE Cluster Architecture" class="md-nav__link">
    The GKE Cluster Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resources" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geographical-placement-and-cluster-types" title="Geographical Placement and Cluster Types" class="md-nav__link">
    Geographical Placement and Cluster Types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_1" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-cloud-iam-and-kubernetes-rbac" title="Google Cloud IAM and Kubernetes RBAC" class="md-nav__link">
    Google Cloud IAM and Kubernetes RBAC
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices_1" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_2" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-access" title="Cluster Access" class="md-nav__link">
    Cluster Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-settings" title="Cluster Settings" class="md-nav__link">
    Cluster Settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-pool-settings" title="Node Pool Settings" class="md-nav__link">
    Node Pool Settings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/bgeesaman/gkesecurity-guide/edit/master/docs/cluster_configuration.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="cluster-configuration">Cluster Configuration<a class="headerlink" href="#cluster-configuration" title="Permanent link">&para;</a></h1>
<h2 id="the-gke-cluster-architecture">The GKE Cluster Architecture<a class="headerlink" href="#the-gke-cluster-architecture" title="Permanent link">&para;</a></h2>
<p>Google Kubernetes Engine makes several key architectural decisions for you that may differ from other Kubernetes <code>cluster</code> installations.  These choices are made in the interest of ease of use, operational simplicity, and security:</p>
<ul>
<li><strong>There is no direct access to the control plane systems</strong> - GKE manages the GCE instances running <code>etcd</code> and the <code>api server</code> and supporting components, and does not expose them to you or an attacker via SSH, for example.  In exchange for giving up direct control over all API server configuration flags, your GKE cluster offers very strong protection of the core components and sensitive data in <code>etcd</code> automatically.  This means your control over the control plane is restricted to the configuration options on the GKE <code>cluster</code> object.</li>
<li><strong>Upgrades are handled via GKE Operations</strong> - Upgrades and downgrades are handled via GKE operations through API calls.  GKE versions (which map to Kubernetes versions) and worker <code>node</code> OS security and version upgrades are all core features of the built-in upgrade process.</li>
<li><strong>The default worker <code>node</code> operating system is COS</strong> - Container-optimized OS is a hardened, minimal operating system engineered specifically to run containers and to function as a Kubernetes worker <code>node</code>.  While SSH is enabled by default and integrates with GCP SSH functionality, it's goal is to make SSHing into each worker <code>node</code> unnecessary by handling patching and upgrades as a part of the <code>node pool</code> lifecycle.  There is an Ubuntu worker <code>node</code> option for supporting unique use cases, but it requires additional administration in terms of upgrades and security patches.</li>
<li><strong>The CNI is not configurable</strong> - The native GKE CNI is used to connect worker <code>nodes</code> and <code>pods</code> to the GCP Network and is not currently replacable.</li>
<li><strong>Network Policy enforcement is done via Calico</strong> - Enabling Network Policy enforcement installs a Calico deployment and daemonset as a managed addon for you.</li>
<li><strong>Logging and Monitoring is done via Stackdriver</strong> - By default, all logs and performance metrics are sent to Stackdriver in the current GCP <code>project</code>.</li>
</ul>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture">GKE Architecture</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/upgrading-a-cluster">GKE Upgrades</a></li>
<li><a href="https://cloud.google.com/container-optimized-os/docs/concepts/features-and-benefits">Container-Optimized OS</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview">GKE CNI</a></li>
<li><a href="https://cloud.google.com/monitoring/kubernetes-engine/">GKE Stackdriver</a></li>
</ul>
<h2 id="geographical-placement-and-cluster-types">Geographical Placement and Cluster Types<a class="headerlink" href="#geographical-placement-and-cluster-types" title="Permanent link">&para;</a></h2>
<p>GKE <code>clusters</code> are by default "zonal" clusters.  That is, a single GCE instance running the control plane components is deployed in the same GCP <code>zone</code> as the <code>node-pool</code> nodes.  "Regional" GKE <code>clusters</code> are deployed across three <code>zones</code> in the same region.  Three GCE instances running the control plane components are deployed (one per <code>zone</code>) behind a single IP and <code>load balancer</code>. The <code>node-pools</code> spread evenly across the <code>zones</code> with a minimum of one <code>node</code> per <code>zone</code>.</p>
<p>The key benefits to a "regional" <code>cluster</code>:</p>
<ul>
<li>The <code>cluster</code> control plane can handle a single GCP <code>zone</code> failure more gracefully.</li>
<li>When the control plane is being upgraded, only one instance is down at a time which leaves two remaining instances.  Upgrades on "zonal" clusters means a 4-10 minute downtime of the API/control plane while that takes place where you can't use <code>kubectl</code> to interact with your <code>cluster</code>.</li>
</ul>
<p>Since there is no additional charge for running a "regional" GKE <code>cluster</code> with a highly-available control plane, why use a "zonal" <code>cluster</code>?  The two primary reasons are to save on "cross-zone" network traffic costs and to support specific GPU <code>node-pool</code> needs.</p>
<div class="admonition note">
<p class="admonition-title">Persistent Disks</p>
<p>The default <code>StorageClass</code> defines persistent disks that are "zonal".  You may want to add a new <code>StorageClass</code> that makes "regional" persistent disks available for <code>pod</code> workloads that get rescheduled on another <code>node</code> in a different <code>zone</code> to still be able to access them.</p>
</div>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Use Regional Clusters</strong> - Unless you have specific needs that force you to use a "zonal" <code>cluster</code>, using "regional" <code>clusters</code> offers the best redundancy and availablility for a minor increase in network traffic costs for the majority of use cases.</li>
<li><strong>Offer a Regional Persistent Disk <code>StorageClass</code></strong> - Allows <code>pods</code> to attach and access persistent disk volumes regardless of where they are scheduled inside the cluster.  This prevents a <code>zone</code> failure from allowing a <code>pod</code> to be rescheduled and mount that disk on a <code>node</code> in another <code>zone</code>.</li>
</ul>
<h3 id="resources_1">Resources<a class="headerlink" href="#resources_1" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/regional-clusters">GKE Regional Clusters</a></li>
</ul>
<h2 id="google-cloud-iam-and-kubernetes-rbac">Google Cloud IAM and Kubernetes RBAC<a class="headerlink" href="#google-cloud-iam-and-kubernetes-rbac" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Google Cloud Identity and Access Management (IAM)</strong> - The system in GCP that grants permissions via GCP <code>IAM Roles</code> to users and service accounts to access GCP APIs.</li>
<li><strong>Kubernetes Role-Based Access Control (RBAC)</strong> - The native system inside Kubernetes that grants permissions via Kubernetes <code>roles</code> and <code>clusterroles</code> to users and service accounts to access the Kubernetes API Server.</li>
</ul>
<p>The two APIs that can be used to interact with the GKE service and a GKE cluster are:</p>
<ol>
<li><strong>GCP GKE API (container.googleapis.com)</strong> - Used to create/update/delete the <code>cluster</code> and <code>node pools</code> that comprise the GKE <code>cluster</code> and to obtain connection and credential information for how to access a given <code>cluster</code>.</li>
<li><strong>Kubernetes API of the <code>cluster</code></strong> - The unique Kubernetes API Server endpoint running on the GKE Control Plane systems for a specific <code>cluster</code>.  It controls resources and access to resources running <em>inside</em> the cluster.</li>
</ol>
<p>This means that there are two main categories of permissions that you have to consider:</p>
<ul>
<li><strong>Cluster Administration</strong> - Permissions associated with administering the <code>cluster</code> itself.</li>
<li><strong>Cluster Usage</strong> - Permissions associated with granting what is allowed to run inside the cluster.</li>
</ul>
<p>There are a couple key points to understand about how Cloud IAM and Kubernetes RBAC can be used to grant permissions in GKE:</p>
<ol>
<li>GCP Cloud IAM is administered at the <code>project</code> level, and the granted permissions apply to all GKE <code>clusters</code> in the <code>project</code>. They remain in-place even if a <code>cluster</code> is deleted from the <code>project</code>.</li>
<li>Kubernetes RBAC permissions are administered per-<code>cluster</code> and are stored inside each <code>cluster</code>.  When that <code>cluster</code> is destroyed, those permissions are also destroyed.</li>
<li>GCP Cloud IAM permissions have no concept of Kubernetes <code>namespaces</code>, so the permissions granted apply for all <code>namespaces</code>.</li>
<li>Kubernetes RBAC can be used to grant permissions to access resources in all <code>namespaces</code> or only in specific <code>namespaces</code>.</li>
<li>Kubernetes RBAC cannot be used to grant permissions to the GCP GKE API (container.googleapis.com).  This is performed solely by Cloud IAM.</li>
<li>Both systems are <em>additive</em> in that they only grant permissions.  They cannot remove or negate permissions from themselves or each other.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">IAM and RBAC <em>combine</em> inside the <code>cluster</code></p>
<p>When accessing a resource (e.g. list pods in the default namespace) via the Kubernetes API of a GKE <code>cluster</code>, it can be granted via IAM <em>or</em> RBAC.  They are effectively combined.  If either grants access, the request is permitted.</p>
</div>
<h3 id="best-practices_1">Best Practices<a class="headerlink" href="#best-practices_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>There are several predefined IAM <code>roles</code> for GKE <code>clusters</code> that can ease administration as you are getting started with GKE.  However, the permissions they grant are often overly broad and violate the priciple of least privileges.  You will want to create custom IAM <code>roles</code> with just the permissions needed, but remember that IAM permissions apply to all <code>namespaces</code> and cannot be limited to a single <code>namespace</code>.</p>
</li>
<li>
<p>To maintain least privilege, it's recommended to leverage a minimal IAM <code>role</code> to gain access to the GKE API and then use Kubernetes RBAC <code>roles</code> and <code>clusterroles</code> to define what resources they can access inside the <code>cluster</code>.</p>
<p>In order for <code>users</code> and <code>service accounts</code> to perform a <code>gcloud container clusters get-credentials</code> call to generate a valid <code>kubeconfig</code> for a GKE <code>cluster</code>, they need to have the following permissions:</p>
<ul>
<li><code>container.apiServices.get</code></li>
<li><code>container.apiServices.list</code></li>
<li><code>container.clusters.get</code></li>
<li><code>container.clusters.list</code></li>
<li><code>container.clusters.getCredentials</code></li>
</ul>
<p>If these permissions are grouped into a custom IAM <code>role</code>, that IAM <code>role</code> can be conveniently bound to a Gsuite/Cloud Identity <code>group</code> which includes all users that need access to the <code>cluster</code>.</p>
<p>From this point, the <code>users</code> and <code>service accounts</code> can be granted access to resources as needed with <code>cluster</code>-wide or per-<code>namespace</code> granularity.  This has the benefit of minimizing IAM changes needed, ensuring access granted is per-<code>cluster</code>, giving the highest granularity, and making troubleshooting permissions an RBAC-only process.</p>
</li>
<li>
<p>With the above approach of deferring nearly all permissions to in-<code>cluster</code> RBAC instead of IAM, there is one exception: assigning the <code>Kubernetes Engine Admin</code> predefined IAM <code>role</code> at the <code>project</code> or <code>folder</code> level to a small number of trusted administrators to ensure that they don't accidentally remove their own access via an RBAC configuration mistake.</p>
</li>
</ul>
<h3 id="resources_2">Resources<a class="headerlink" href="#resources_2" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/access-control">GKE IAM and RBAC</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam#predefined">Predefined GKE Roles</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control">GKE RBAC</a></li>
</ul>
<h2 id="cluster-access">Cluster Access<a class="headerlink" href="#cluster-access" title="Permanent link">&para;</a></h2>
<h2 id="cluster-settings">Cluster Settings<a class="headerlink" href="#cluster-settings" title="Permanent link">&para;</a></h2>
<h2 id="node-pool-settings">Node Pool Settings<a class="headerlink" href="#node-pool-settings" title="Permanent link">&para;</a></h2>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../project_organization/" title="Project Organization" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Project Organization
              </span>
            </div>
          </a>
        
        
          <a href="../cluster_lifecycle/" title="Cluster Lifecycle" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Cluster Lifecycle
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/bgeesaman" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/bradgeesaman" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/bradgeesaman" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>