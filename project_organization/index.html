



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-\.]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Project Organization - The Unofficial GKE Security Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#project-organization" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="The Unofficial GKE Security Guide" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              The Unofficial GKE Security Guide
            </span>
            <span class="md-header-nav__topic">
              
                Project Organization
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/bgeesaman/gkesecurity-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    bgeesaman/gkesecurity-guide
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="The Unofficial GKE Security Guide" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    The Unofficial GKE Security Guide
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/bgeesaman/gkesecurity-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    bgeesaman/gkesecurity-guide
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cloud_environment/" title="Cloud Environment" class="md-nav__link">
      Cloud Environment
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Project Organization
      </label>
    
    <a href="./" title="Project Organization" class="md-nav__link md-nav__link--active">
      Project Organization
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-and-environment-separation" title="Project and Environment Separation" class="md-nav__link">
    Project and Environment Separation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strategy-descriptions" title="Strategy Descriptions" class="md-nav__link">
    Strategy Descriptions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#separating-tenants" title="Separating Tenants" class="md-nav__link">
    Separating Tenants
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices_1" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_1" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-quotas" title="Project Quotas" class="md-nav__link">
    Project Quotas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices_2" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_2" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_configuration/" title="Cluster Configuration" class="md-nav__link">
      Cluster Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_lifecycle/" title="Cluster Lifecycle" class="md-nav__link">
      Cluster Lifecycle
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_observability/" title="Cluster Observability" class="md-nav__link">
      Cluster Observability
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cluster_addons/" title="Cluster Add-ons" class="md-nav__link">
      Cluster Add-ons
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../workload_configuration/" title="Workload Configuration" class="md-nav__link">
      Workload Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../container_images/" title="Container Images" class="md-nav__link">
      Container Images
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../audit_and_compliance/" title="Audit and Compliance" class="md-nav__link">
      Audit and Compliance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../detection_and_response/" title="Detection and Response" class="md-nav__link">
      Detection and Response
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../weaknesses_and_misconfigurations/" title="Common Weaknesses and Misconfigurations" class="md-nav__link">
      Common Weaknesses and Misconfigurations
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-and-environment-separation" title="Project and Environment Separation" class="md-nav__link">
    Project and Environment Separation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strategy-descriptions" title="Strategy Descriptions" class="md-nav__link">
    Strategy Descriptions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#separating-tenants" title="Separating Tenants" class="md-nav__link">
    Separating Tenants
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices_1" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_1" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-quotas" title="Project Quotas" class="md-nav__link">
    Project Quotas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#best-practices_2" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_2" title="Resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/bgeesaman/gkesecurity-guide/edit/master/docs/project_organization.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="project-organization">Project Organization<a class="headerlink" href="#project-organization" title="Permanent link">&para;</a></h1>
<h2 id="project-and-environment-separation">Project and Environment Separation<a class="headerlink" href="#project-and-environment-separation" title="Permanent link">&para;</a></h2>
<p>Using the <a href="https://github.com/GoogleCloudPlatform/microservices-demo">Hipster Shop</a> as an example workload of eleven coordinating microservices that form a "service offering", there are a few different approaches for how to organize GCP <code>projects</code> and GKE <code>clusters</code>.  Each has pros and cons from a security perspective.</p>
<ol>
<li>
<p><strong>Single GCP Project, Single GKE Cluster, Namespaces per Environment</strong> - A single <code>project</code> named <code>my-hipster-shop</code> with a GKE <code>cluster</code> named <code>gke-hipster-shop</code> and three Kubernetes <code>namespaces</code>: <code>hipster-shop-dev</code>, <code>hipster-shop-test</code>, and <code>hipster-shop-prod</code>.</p>
<ul>
<li>Pros<ul>
<li>Simplest <code>project</code> strategy</li>
<li>Simplest <code>network</code> strategy</li>
<li>Least expensive <code>cluster</code> strategy</li>
</ul>
</li>
<li>Cons<ul>
<li>Weakest "isolation" strategy</li>
<li>Weakest "defense in depth" strategy</li>
<li>Weakest "resource contention" strategy</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Single GCP Project, Three GKE Clusters</strong> - A single <code>project</code> named <code>my-hipster-shop</code> with three GKE <code>clusters</code> named <code>gke-hipster-shop-dev</code>, <code>gke-hipster-shop-test</code>, and <code>gke-hipster-shop-prod</code>.  A single <code>namespace</code> named <code>hipster-shop</code> is in each <code>cluster</code>.</p>
<ul>
<li>Pros<ul>
<li>Good "isolation" strategy</li>
<li>Good "defense in depth" strategy</li>
<li>Good "resource contention" strategy</li>
</ul>
</li>
<li>Cons<ul>
<li>Most complex <code>project</code> strategy</li>
<li>Simple <code>network</code> strategy</li>
<li>Most expensive <code>cluster</code> strategy</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Three GCP Projects, Single GKE Cluster per Project</strong> - Three <code>projects</code> named <code>my-hipster-shop-dev</code>, <code>my-hipster-shop-test</code>, and <code>my-hipster-shop-prod</code>.  In each <code>project</code>, a GKE <code>cluster</code> named <code>gke-hipster-shop-&lt;env&gt;</code>, and a single <code>namespace</code> named <code>hipster-shop</code> in each <code>cluster</code>.</p>
<ul>
<li>Pros<ul>
<li>Strongest "isolation" strategy</li>
<li>Strongest "defense in depth" strategy</li>
<li>Strongest "resource contention" strategy</li>
</ul>
</li>
<li>Cons<ul>
<li>Most complex <code>project</code> strategy</li>
<li>Most complex <code>network</code> strategy</li>
<li>Most expensive <code>cluster</code> strategy</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="strategy-descriptions">Strategy Descriptions<a class="headerlink" href="#strategy-descriptions" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Project Complexity</strong> - Although GCP <code>projects</code> are "free", this refers to the ongoing maintenance and operational overhead of managing and caring for GCP <code>projects</code>.  Managing 5 <code>projects</code> vs 15 vs 150 has challenges that require more sophisticated tooling and processes to do well.</li>
<li><strong>Network Complexity</strong> - Having all GKE <code>clusters</code> on the same shared VPC <code>network</code> or in separate VPC <code>networks</code> will vary the amount of ongoing maintenance of IP CIDR allocation/consumption, Interconnect/Cloud VPN configuration complexity, and complexity of collecting network related flow logs.</li>
<li><strong>Cluster Cost</strong> - While the control plane of GKE is free, the additional GKE worker nodes in three <code>clusters</code> vs one plus the additional maintenance cost of managing (upgrading, securing, monitoring) more <code>clusters</code> increases the overall cost.</li>
<li><strong>Isolation</strong> - Does the configuration leverage harder boundary mechanisms like GCP <code>projects</code>, separate GKE <code>clusters</code> on separate GCE <code>instances</code>, or does it rely on softer boundaries like Kubernetes <code>namespaces</code>?</li>
<li><strong>Defense in Depth</strong> - Should a security incident occur, which strategy serves to reduce the available attack surface by default, make lateral movement more difficult to perform successfully, and make malicious activity easier to identify vs normal activity?</li>
<li><strong>Resource Contention</strong> - Are workloads competing for resources on the same <code>nodes</code>, <code>clusters</code>, or <code>projects</code>?  Is it possible for a single workload to over-consume resources such that the <code>nodes</code> evict <code>pods</code>?  If the <code>cluster</code> autoscales to add more <code>nodes</code>, does that consume all available <code>cpu</code>/<code>memory</code>/<code>disk</code> quota in the <code>project</code> and prevent other <code>clusters</code> from having available resources to autoscale if they need to grow?</li>
</ul>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Standardize Early</strong> - Understand that you will be building tools and processes implicitly and explicitly around your approach, so choose the one that meets your requirements and be consistent across all your GKE deployments.  Automation with infrastructure-as-code tools like Terraform for standardizing configuration and naming conventions of <code>projects</code> and <code>clusters</code> is strongly encouraged.</li>
<li><strong>One Cluster per Project</strong> - While it is the most expensive approach to operate, it offers the best permissions isolation, defense-in-depth, and resource contention strategy by default.  If you are serious about service offering and environment separation and have any compliance requirements, this is the best way to achieve those objectives.</li>
<li><strong>One Cluster per Service Offering</strong> - Running one <code>cluster</code> per colocated set of services with similar data gravity and redundancy needs is ideal for reducing the "blast radius" of an incident. It might seem convenient to place three or four smaller "production" services into a single GKE <code>cluster</code>, but consider the scope of an investigation should a compromise occur.  All workloads in that <code>cluster</code> and all the data they touch would have to be "in scope" for the remediation efforts.</li>
</ul>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cloud.google.com/solutions/prep-kubernetes-engine-for-prod">Preparing GKE Environments for Production</a></li>
<li><a href="https://cloud.google.com/products/calculator/">GCP Cost Calculator</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/pricing">GKE Pricing</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/microservices-demo">Hipster Shop</a></li>
<li><a href="https://terraform.io">Terraform</a></li>
</ul>
<h2 id="separating-tenants">Separating Tenants<a class="headerlink" href="#separating-tenants" title="Permanent link">&para;</a></h2>
<p>The previous section covers the "cluster per project" approaches, and this section attempts to guide you through the "workloads per cluster" decisions. Two important definitions to cover first are <a href="https://docs.google.com/document/d/1PjlsBmZw6Jb3XZeVyZ0781m6PV7-nSUvQrwObkvz7jg/edit">Hard and Soft tenancy</a> as written by Jessie Frazelle:</p>
<ul>
<li><strong>Soft multi-tenancy</strong> - multiple users <em>within the same organization</em> in the same <code>cluster</code>. Soft multi-tenancy could have possible bad actors such as people leaving the company, etc. Users are not thought to be actively malicious since they are within the same organization, but potential for accidents or "evil leaving employees." A large focus of soft multi-tenancy is to prevent accidents.</li>
<li><strong>Hard multi-tenancy</strong> - multiple users, from various places, in the same <code>cluster</code>.  Hard multi-tenancy means that anyone on the <code>cluster</code> is thought to be potentially malicious and therefore should not have access to any other tenants resources.</li>
</ul>
<p>From experience, building and operating a <code>cluster</code> with a hard-tenancy use case in mind is very difficult.  The tools and capabilties are improving in this area, but it requires extreme attention to detail, careful planning, 100% visibility into activity, and near-hyper active monitoring.  For these reasons, your journey with Kubernetes and GKE should first solve for the soft-tenancy use case.  The understanding and lessons learned will overlap nearly 100% if you decide to go for hard-tenancy and will <em>absolutely</em> give you the proper frame of reference to decide if your organization can tackle the added challenges.</p>
<div class="admonition warning">
<p class="admonition-title">There is no such thing as a "single-tenant" <code>cluster</code></p>
<p>When it comes to workloads, there are always a minimum of two classes: "System" and "User" workloads.  Workloads that are responsible for the operation of the <code>cluster</code> (CNI, log export, metrics export, etc) should be isolated from workloads that run actual applications and vice versa.</p>
</div>
<p>In Kubernetes, the default separation between these workload types is likely not sufficient for production needs.  System components run on the same physical resources as user workloads, share a common administrative mechanism, share a common layer 3 network with no default access controls, and often run with higher privileges.  Even in GKE, you will want to take steps to address these concerns.</p>
<ol>
<li><strong>API Isolation</strong> - Using separate Kubernetes <code>namespaces</code> to segment workloads for different purposes when it comes to how those resources interact with the Kubernetes API only.  Service accounts per <code>namespace</code> tied to granular RBAC policies are the primary approach.</li>
<li><strong>Network Isolation</strong> - Using Kubernetes <code>namespaces</code> as an anchor point, defining which <code>pods</code> are allowed to talk with each other explicitly via <code>NetworkPolicy</code> objects is the primary approach.  For instance, preventing all ingress traffic from non-<code>kube-system</code> <code>namespaces</code> with the exception of <code>udp/53</code> for <code>kube-dns</code>.</li>
<li><strong>Privilege Isolation</strong> - Leveraging well-formed containers running as non-privileged users in combination with <code>PodSecurityPolicies</code> to prevent user workloads from being able to access sensitive or privileged resources on the worker node and undermining the security of all workloads.</li>
<li><strong>Resource Isolation</strong> - Using features like <code>ResourceQuotas</code> to cap overal cpu/memory/persistent disk resource consumption, resources <code>requests</code> and <code>limits</code> to ensure <code>pods</code> are given the resources they need without overcrowding other workloads, and separating security or performance sensitive workloads on separate <code>Node Pools</code>. </li>
</ol>
<p>Whether you are a single developer running a couple microservices in one <code>cluster or</code> a large <code>organization</code> with many teams sharing large <code>clusters</code>, these concerns are important and should not be overlooked.  The remainder of this guide will attempt to show you how to implement these features in combination and give you confidence in the decisions you make for your use case.</p>
<h3 id="best-practices_1">Best Practices<a class="headerlink" href="#best-practices_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Tenants per Cluster</strong> - From a security perspective, having a single tenant per <code>cluster</code> provides the highest degree of separation among tenants, but it is common to allow multiple workloads from different users/teams of similar trust levels to share a <code>cluster</code> for cost and operational efficiency.</li>
<li><strong>Multiple Untrusted Tenants in a Single Cluster</strong> - This approach is not generally recommended as the level of effort to sufficiently isolate workloads is high and the risk of a vulnerability or mistake leading to a tenant escape is much higher.</li>
<li><strong>Separate the System from the Workloads</strong> - No matter which approach is taken, you should take steps to properly isolate the <code>pods</code> and <code>services</code> that control and manage your <code>cluster</code> from the workloads that operate in them.  The system components can have permissions to GCP resources outside your <code>cluster</code>, and it's important that an incident with a user workload can't escape to the system workloads and then escape "outside" the <code>cluster</code>.</li>
</ul>
<h3 id="resources_1">Resources<a class="headerlink" href="#resources_1" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://blog.jessfraz.com/post/hard-multi-tenancy-in-kubernetes/">Hard Multi-Tenancy in Kubernetes</a></li>
<li><a href="https://docs.google.com/document/d/1PjlsBmZw6Jb3XZeVyZ0781m6PV7-nSUvQrwObkvz7jg/edit">Multi-Tenancy Design Space</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/multitenancy-overview">GKE Cluster Multi-Tenancy</a></li>
</ul>
<h2 id="project-quotas">Project Quotas<a class="headerlink" href="#project-quotas" title="Permanent link">&para;</a></h2>
<p>GCP <code>projects</code> have quotas or limits on how many resources are available for potential use.  This doesn't mean that there is available capacity to fulfill the request, and on rare occasions, a particular zone might not be able to provide another GKE worker right away when your <code>cluster</code> workloads need more capacity and node-pool autoscaling kicks in.</p>
<p>GKE uses several GCE related quotas like <code>cpu</code>, <code>memory</code>, <code>disk</code>, and <code>gpu</code> of a particular type, but it also uses lesser known quotas like "Number of secondary ranges per VPC".  The resource related quotas are per region and sometimes per zone, so it's important to monitor your quota usage to avoid quota-capped resource exhaustion scenarios from negatively affecting your application's performance during a scale-up event or from preventing certain types of upgrade scenarios.</p>
<h3 id="best-practices_2">Best Practices<a class="headerlink" href="#best-practices_2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Monitor Quota Consumption</strong> - Smaller GKE <code>clusters</code> will most likely fit into the <code>project</code> quota defaults, but <code>clusters</code> of a dozen nodes or more may start to bump into the limits.</li>
<li><strong>Request Quota Increases Ahead of Time</strong> - Quota increases can take as much as 48 hrs to be approved, so it's best to plan ahead and ask early.</li>
<li><strong>Aim for 110%</strong> - If the single GKE <code>cluster</code> in a project uses 10, 32-core <code>nodes</code>, the total <code>cpu</code> cores needed is 320 or more.  To give enough headroom to perform a "blue/green" <code>cluster</code> upgrade if needed (bringing up an identical <code>cluster</code> in parallel), the <code>project</code> quota should be at least 640 <code>cpu</code> cores in that region to facilitate that approach.  Following the 110% guideline, this would actually be more like 700 <code>cpus</code>.  This allows for two, full-sized <code>clusters</code> to be possible for a short duration while the workloads are migrated between the <code>clusters</code>.</li>
<li><strong>GCP APIs have Rate Limits</strong> - If your application makes 100s of requests per second or more to say, GCS or GCR, you may run into rate limits designed to protect overuse of the GCP APIs from a single customer affecting all customers.  If you run into these, you may or may not be able to get them increased.  Consider working with GCP support and implementing a different approach with your application.</li>
</ul>
<h3 id="resources_2">Resources<a class="headerlink" href="#resources_2" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cloud.google.com/compute/quotas">GCE Quotas and Limits</a></li>
<li><a href="https://cloud.google.com/docs/quota">Working with GCP Quotas</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cloud_environment/" title="Cloud Environment" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cloud Environment
              </span>
            </div>
          </a>
        
        
          <a href="../cluster_configuration/" title="Cluster Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Cluster Configuration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/bgeesaman" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/bradgeesaman" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/bradgeesaman" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>